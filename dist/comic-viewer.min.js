!function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){var t=/^(.*)\[(\d+)-(\d+)\](.*)$/;if(!t.test(e))return[e];var n=e.match(t),r=n[2]-0,c=n[3]-0,a=n[1],l=n[4],s=r<c?r:c,u=r<c?c:r,d=n[2].length;if(Number.isNaN(s)||Number.isNaN(u))throw new Error("Check your url. The pattern should be like this: /images/[001-032].jpg");return i(s,u).map(function(e){return a+o(e,d)+l})}function i(e,t){return Array.from({length:t-e+1},function(t,n){return(t||e)+n})}function o(e,t){var n=e+"",i=t-n.length;return(i>0?"0".repeat(i):"")+n}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){return Object.keys(e).filter(function(e){return void 0!==t[e]}).reduce(function(t,n){return Object.assign(t,r({},n,e[n]))},{})}function u(e,t,n,i){return t=t||1e3,n=n||!1,i=i||window,E[i]=e,new Promise(function(o,r){function c(n){if(e!==E[i])return r(new Error("Another scroll detected"));if((f+=Math.PI/(t/(n-h)))>=Math.PI)return a(e),o();if(l()===e)return o();var s=e+Math.round(u+u*Math.cos(f));if(a(s),s===e)return o();h=n,window.requestAnimationFrame(c)}function a(e){n?i.scrollLeft=e:i.scrollTop=e}function l(){return n?i.scrollLeft:i.scrollTop}var s=l(),u=(s-e)/2,f=0,h=d();window.requestAnimationFrame(c)})}function d(){return window.performance?window.performance.now():window.Date.now()}function f(e){return new Promise(function(t,n){window.setTimeout(t,e)})}function h(e){return!!e.requestFullscreen||(!!e.webkitRequestFullscreen||(!!e.mozRequestFullScreen||!!e.msRequestFullscreen))}function g(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function w(){var e=document;e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.msExitFullscreen&&e.msExitFullscreen()}function v(e){var t=document.addEventListener;t("fullscreenchange",e),t("webkitfullscreenchange",e),t("mozfullscreenchange",e),t("MSFullscreenChange",e)}function m(e){var t=document.removeEventListener;t("fullscreenchange",e),t("webkitfullscreenchange",e),t("mozfullscreenchange",e),t("MSFullscreenChange",e)}function p(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}e="default"in e?e.default:e,e.tag2("icon-fullscreen",'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewbox="0 0 384.97 384.97"> <path d="M384.97,12.03c0-6.713-5.317-12.03-12.03-12.03H264.847c-6.833,0-11.922,5.39-11.934,12.223 c0,6.821,5.101,11.838,11.934,11.838h96.062l-0.193,96.519c0,6.833,5.197,12.03,12.03,12.03c6.833-0.012,12.03-5.197,12.03-12.03 l0.193-108.369c0-0.036-0.012-0.06-0.012-0.084C384.958,12.09,384.97,12.066,384.97,12.03z"></path> <path d="M120.496,0H12.403c-0.036,0-0.06,0.012-0.096,0.012C12.283,0.012,12.247,0,12.223,0C5.51,0,0.192,5.317,0.192,12.03 L0,120.399c0,6.833,5.39,11.934,12.223,11.934c6.821,0,11.838-5.101,11.838-11.934l0.192-96.339h96.242 c6.833,0,12.03-5.197,12.03-12.03C132.514,5.197,127.317,0,120.496,0z"></path> <path d="M120.123,360.909H24.061v-96.242c0-6.833-5.197-12.03-12.03-12.03S0,257.833,0,264.667v108.092 c0,0.036,0.012,0.06,0.012,0.084c0,0.036-0.012,0.06-0.012,0.096c0,6.713,5.317,12.03,12.03,12.03h108.092 c6.833,0,11.922-5.39,11.934-12.223C132.057,365.926,126.956,360.909,120.123,360.909z"></path> <path d="M372.747,252.913c-6.833,0-11.85,5.101-11.838,11.934v96.062h-96.242c-6.833,0-12.03,5.197-12.03,12.03 s5.197,12.03,12.03,12.03h108.092c0.036,0,0.06-0.012,0.084-0.012c0.036-0.012,0.06,0.012,0.096,0.012 c6.713,0,12.03-5.317,12.03-12.03V264.847C384.97,258.014,379.58,252.913,372.747,252.913z"></path> </svg>','icon-fullscreen,[data-is="icon-fullscreen"]{ display: inline-block; width: 32px; fill: currentColor; }',"",function(e){}),e.tag2("icon-close",'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewbox="0 0 384.97 384.97"> <path d="M384.97,12.03c0-6.713-5.317-12.03-12.03-12.03H264.847c-6.833,0-11.922,5.39-11.934,12.223 c0,6.821,5.101,11.838,11.934,11.838h96.062l-0.193,96.519c0,6.833,5.197,12.03,12.03,12.03c6.833-0.012,12.03-5.197,12.03-12.03 l0.193-108.369c0-0.036-0.012-0.06-0.012-0.084C384.958,12.09,384.97,12.066,384.97,12.03z"></path> <path d="M120.496,0H12.403c-0.036,0-0.06,0.012-0.096,0.012C12.283,0.012,12.247,0,12.223,0C5.51,0,0.192,5.317,0.192,12.03 L0,120.399c0,6.833,5.39,11.934,12.223,11.934c6.821,0,11.838-5.101,11.838-11.934l0.192-96.339h96.242 c6.833,0,12.03-5.197,12.03-12.03C132.514,5.197,127.317,0,120.496,0z"></path> <path d="M120.123,360.909H24.061v-96.242c0-6.833-5.197-12.03-12.03-12.03S0,257.833,0,264.667v108.092 c0,0.036,0.012,0.06,0.012,0.084c0,0.036-0.012,0.06-0.012,0.096c0,6.713,5.317,12.03,12.03,12.03h108.092 c6.833,0,11.922-5.39,11.934-12.223C132.057,365.926,126.956,360.909,120.123,360.909z"></path> <path d="M372.747,252.913c-6.833,0-11.85,5.101-11.838,11.934v96.062h-96.242c-6.833,0-12.03,5.197-12.03,12.03 s5.197,12.03,12.03,12.03h108.092c0.036,0,0.06-0.012,0.084-0.012c0.036-0.012,0.06,0.012,0.096,0.012 c6.713,0,12.03-5.317,12.03-12.03V264.847C384.97,258.014,379.58,252.913,372.747,252.913z"></path> </svg>','icon-close,[data-is="icon-close"]{ display: block; width: 32px; fill: currentColor; padding: 4px; }',"",function(e){});var b=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),k=new WeakMap,y=function(){function e(){t(this,e),k.set(this,{events:{}}),this.eventLength=0}return b(e,[{key:"on",value:function(e,t){if(void 0===t)throw new Error("You must provide a callback method.");if("function"!=typeof t)throw new TypeError("Listener must be a function");return this.events[e]=this.events[e]||[],this.events[e].push(t),this.eventLength++,this}},{key:"off",value:function(e,t){if(void 0===t)throw new Error("You must provide a callback method.");if("function"!=typeof t)throw new TypeError("Listener must be a function");if(void 0===this.events[e])throw new Error("Event not found - the event you provided is: "+e);var n=this.events[e];return n.forEach(function(e,i){e===t&&n.splice(i,1)}),0===n.length&&(delete this.events[e],this.eventLength--),this}},{key:"trigger",value:function(e){for(var t=this,n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];if(void 0===e)throw new Error("You must provide an event to trigger.");var r=this.events[e];return void 0!==r&&(r=r.slice(0),r.forEach(function(e){e.apply(t,i)})),this}},{key:"events",get:function(){return k.get(this).events}}]),e}(),x=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),L=[0,1,-1,-2,2,3,4,5,6,7],S={title:"",firstPageSpread:!1,rightToLeft:!0,defaultPageWidth:595,defaultPageHeight:842},F=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=Array.isArray(e)?e:n(e);return Object.assign(o,S,s(i,S)),o.pages=r.map(function(e){return new P(e,{defaultPageWidth:o.defaultPageWidth,defaultPageHeight:o.defaultPageHeight})}),o.que=[],o.loadingPage=null,o}return l(t,e),x(t,[{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t-=0,this.que=L.map(function(e){return e+t}).filter(function(t){return t>=0&&t<e.pages.length}).map(function(t){return e.pages[t]}).filter(function(e){return!e.loaded&&!e.loading}),this.loadingPage||this.loadNextInQue()}},{key:"loadNextInQue",value:function(){var e=this;this.loadingPage=this.que.shift(),this.loadingPage&&(this.loadingPage.on("imageLoaded",function(t){e.trigger("pageLoaded",t),e.loadNextInQue()}),this.loadingPage.load())}}]),t}(y),P=function(e){function t(e,n){c(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.url=e,i.loading=!1,i.loaded=!1,i.width=n.defaultPageWidth,i.height=n.defaultPageHeight,i}return l(t,e),x(t,[{key:"load",value:function(){var e=this;this.loading=!0;var t=new window.Image;t.src=this.url,t.onload=function(){var n=t.width,i=t.height;e.width=n,e.height=i,e.loaded=!0,e.loading=!1,e.trigger("imageLoaded",e)}}}]),t}(y),E={};e.tag2("comic-viewer",'<div class="btn-go-forward" onclick="{goForward}"></div> <div class="btn-go-back" onclick="{goBack}"></div> <header if="{title && toolbarMode}">{title}</header> <div class="outer" riot-style="{outerStyle}"> <div ref="stage" class="inner" riot-style="{innerStyle}" onclick="{toggleMode}" ondblclick="{toggleFullScreen}"> <img if="{plusOneBefore && !rightToLeft}" class="dummy" riot-src="{stack[0].url}"> <img if="{plusOneAfter && rightToLeft}" class="dummy" riot-src="{stack[stack.length - 1].url}"> <img each="{stack}" riot-src="{url}"> <img if="{plusOneBefore && rightToLeft}" class="dummy" riot-src="{stack[0].url}"> <img if="{plusOneAfter && !rightToLeft}" class="dummy" riot-src="{stack[stack.length - 1].url}"> </div> </div> <footer if="{toolbarMode}"> <icon-fullscreen if="{!fullScreenMode}" onclick="{toggleFullScreen}"></icon-fullscreen> <icon-close if="{fullScreenMode}" onclick="{toggleFullScreen}"></icon-close> </footer>','comic-viewer,[data-is="comic-viewer"]{ display: block; position: relative; background: #333; overflow: hidden; } comic-viewer:focus,[data-is="comic-viewer"]:focus{ outline: none; } comic-viewer header,[data-is="comic-viewer"] header,comic-viewer footer,[data-is="comic-viewer"] footer,comic-viewer .btn-go-forward,[data-is="comic-viewer"] .btn-go-forward,comic-viewer .btn-go-back,[data-is="comic-viewer"] .btn-go-back{ position: absolute; z-index: 100; } comic-viewer.fullscreen header,[data-is="comic-viewer"].fullscreen header,comic-viewer.fullscreen footer,[data-is="comic-viewer"].fullscreen footer,comic-viewer.fullscreen .btn-go-forward,[data-is="comic-viewer"].fullscreen .btn-go-forward,comic-viewer.fullscreen .btn-go-back,[data-is="comic-viewer"].fullscreen .btn-go-back{ position: fixed; } comic-viewer header,[data-is="comic-viewer"] header{ top: 0; left: 0; right: 0; height: 24px; padding: 0 1em; background: rgba(0,0,0,.8); color: rgba(255,255,255,.7); line-height: 24px; font-size: 80%; overflow: hidden; } comic-viewer footer,[data-is="comic-viewer"] footer{ bottom: 0; left: 0; right: 0; height: 32px; background: rgba(0,0,0,.8); color: rgba(255,255,255,.7); padding: 14px; } comic-viewer footer > icon-fullscreen,[data-is="comic-viewer"] footer > icon-fullscreen,comic-viewer footer > icon-close,[data-is="comic-viewer"] footer > icon-close{ float: right; } comic-viewer .outer,[data-is="comic-viewer"] .outer{ overflow: hidden; } comic-viewer .inner,[data-is="comic-viewer"] .inner{ padding-bottom: 30px; display: flex; flex-direction: row; overflow: hidden; -webkit-overflow-scrolling: auto; } comic-viewer .btn-go-forward,[data-is="comic-viewer"] .btn-go-forward,comic-viewer .btn-go-back,[data-is="comic-viewer"] .btn-go-back{ top: 0; bottom: 0; width: 25%; } comic-viewer .btn-go-forward,[data-is="comic-viewer"] .btn-go-forward,comic-viewer.rtol .btn-go-back,[data-is="comic-viewer"].rtol .btn-go-back{ right: 0; left: auto; } comic-viewer .btn-go-back,[data-is="comic-viewer"] .btn-go-back,comic-viewer.rtol .btn-go-forward,[data-is="comic-viewer"].rtol .btn-go-forward{ right: auto; left: 0; } comic-viewer div > img,[data-is="comic-viewer"] div > img{ height: 100%; } comic-viewer div > img.dummy,[data-is="comic-viewer"] div > img.dummy{ visibility: hidden; }','class="{fullscreen: fullScreenMode, rtol: rightToLeft}" tabindex="0" riot-style="{style}"',function(e){var t=this,n=void 0,i=0,o=0,r=!1,c=!1,a=!1;this.title="",this.firstPageSpread=!1,this.rightToLeft=!0,this.currentIndex=0,this.currentIndexInStack=0,this.stack=[],this.style="",this.stageStyle="",this.landscapeMode=!1,this.toolbarMode=!1,this.fullScreenMode=!1,this.on("mount",function(){r=h(t.root),n=new F(e.pages,{title:e.title,firstPageSpread:"yes"===e.firstPageSpread,rightToLeft:void 0===e.direction||"manga"===e.direction}),n.on("pageLoaded",function(e){a||t.update()});var i=n.title,o=n.firstPageSpread,c=n.rightToLeft,l=e.pages,s=(window.localStorage.getItem(l)||0)-0,u=(e.width?"width:"+e.width+"px;":"")+(e.height?"height:"+e.height+"px;":"");n.load(s),t.root.setAttribute("style",u);var d={title:i,firstPageSpread:o,rightToLeft:c,currentIndex:s,style:u};t.update(d),v(t.update),window.addEventListener("optimizedResize",t.update),t.root.addEventListener("keydown",t.keydown),t.root.addEventListener("touchstart",t.touchstart),t.root.addEventListener("touchmove",t.touchmove),t.root.addEventListener("touchend",t.touchend)}),this.on("update",function(){var i=t.currentIndex,o=n.pages.length,a=n.rightToLeft,l=t.firstPageSpread,s=p()||c,u=s?window.innerWidth:e.width?"width:"+e.width+"px;":"",d=s?window.innerHeight:e.height?"height:"+e.height+"px;":"",f=u+d,h=s?window.innerWidth:t.root.offsetWidth,g=s?window.innerHeight:t.root.offsetHeight,w=t.stack.length?t.stack[0].width:n.defaultPageWidth,v=t.stack.length?t.stack[0].height:n.defaultPageHeight,m=h/g,b=g<h,k=w*(b?2:1)/v,y=m>k?g*k:h,x=m>k?g:h/k,L=m>k?x/v:y/(b?2:1)/w,S=m>k?0:(g-x)/2,F=m>k?(h-y)/2:0,P=r||!s?"":"\n        position: fixed;\n        top: 0; right: 0; bottom: 0; left: 0;\n      ",E=P+"\n        width: "+y+"px;\n        height: "+x+"px;\n        margin: "+S+"px "+F+"px;\n      ",M="\n        width: "+y+"px;\n        height: "+x+"px;\n      ",z=i-(b?2:1),I=z>=0?z:0,T=b&&!l&&0===I,C=z+(b?6:3)-(T&&0===i),O=C<o?C:o,q=b&&!!(o%2-!l)&&!(O!==o),j=i-I,H=a?n.pages.slice(I,O).reverse():n.pages.slice(I,O),R=a?H.slice(j+(!b||T&&0===i?1:2),H.length):H.slice(0,j),A=L*((!a&&T&&i>0?n.pages[0].width:0)+R.reduce(function(e,t){return e+t.width},0)+(a&&q&&i<o-1?n.pages[o-1].width:0));Object.assign(t,{fullScreenMode:s,landscapeMode:b,style:f,stageWidth:y,innerStyle:M,outerStyle:E,currentIndexInStack:j,stack:H,plusOneBefore:T,plusOneAfter:q,scrollLeft:A})}),this.on("updated",function(){f(50).then(function(){t.refs.stage.scrollLeft=t.scrollLeft})}),this.on("unmount",function(){m(t.update),window.removeEventListener("optimizedResize",t.update),t.root.removeEventListener("keydown",t.keydown)}),this.toggleMode=function(e){t.toolbarMode=!t.toolbarMode},this.toggleFullScreen=function(e){r?t.fullScreenMode?w():g(t.root):c=!t.fullScreenMode},this.adjustScrollPosition=function(e){var n=t.refs.stage,i=t.stageWidth,o=n.scrollLeft-t.scrollLeft;return o<-1*i*.33?u(0,500,!0,n).then(t.goForward):o>.33*i?u(2*i,500,!0,n).then(t.goBack):u(t.scrollLeft,500,!0,n).then(t.update)},this.touchstart=function(e){1==e.touches.length&&(i=t.refs.stage.scrollLeft,o=e.touches[0].clientX,a=!0)},this.touchmove=function(e){if(1==e.touches.length){var n=i-(e.touches[0].clientX-o);t.refs.stage.scrollLeft=n}},this.touchend=function(e){if(1==e.changedTouches.length){var n=i-(e.changedTouches[0].clientX-o);t.refs.stage.scrollLeft=n,t.adjustScrollPosition().then(function(){a=!1})}},this.keydown=function(e){switch(e.keyCode){case 37:return t.rightToLeft?t.goForward():t.goBack(),void e.preventDefault();case 39:t.rightToLeft?t.goBack():t.goForward(),e.preventDefault()}},this.goForward=function(){var e=t.currentIndex,i=n.pages.length,o=t.landscapeMode,r=t.firstPageSpread,c=i-1-(o&&!(i%2-!r));e>=c?t.currentIndex=c:t.currentIndex+=o&&(r||0!==e)?2:1,n.load(t.currentIndex),t.update(),t.saveBookmark()},this.goBack=function(){t.currentIndex-=t.landscapeMode?2:1,t.currentIndex<0&&(t.currentIndex=0),n.load(t.currentIndex),t.update(),t.saveBookmark()},this.saveBookmark=function(){var n=e.pages;window.localStorage.setItem(n,t.currentIndex)}}),function(e,t,n){n=n||window;var i=!1;n.addEventListener(e,function(){i||(i=!0,window.requestAnimationFrame(function(){n.dispatchEvent(new window.CustomEvent(t)),i=!1}))})}("resize","optimizedResize")}(riot);