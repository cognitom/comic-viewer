!function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){var t=/^(.*)\[(\d+)-(\d+)\](.*)$/;if(!t.test(e))return[e];var n=e.match(t),r=n[2]-0,c=n[3]-0,a=n[1],l=n[4],s=r<c?r:c,u=r<c?c:r,d=n[2].length;if(Number.isNaN(s)||Number.isNaN(u))throw new Error("Check your url. The pattern should be like this: /images/[001-032].jpg");return o(s,u).map(function(e){return a+i(e,d)+l})}function o(e,t){return Array.from({length:t-e+1},function(t,n){return(t||e)+n})}function i(e,t){var n=e+"",o=t-n.length;return(o>0?"0".repeat(o):"")+n}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){return Object.keys(e).filter(function(e){return void 0!==t[e]}).reduce(function(t,n){return Object.assign(t,r({},n,e[n]))},{})}function u(e,t,n,o){return t=t||1e3,n=n||!1,o=o||window,P[o]=e,new Promise(function(i,r){function c(n){if(e!==P[o])return r(new Error("Another scroll detected"));if((f+=Math.PI/(t/(n-h)))>=Math.PI)return a(e),i();if(l()===e)return i();var s=e+Math.round(u+u*Math.cos(f));if(a(s),s===e)return i();h=n,window.requestAnimationFrame(c)}function a(e){n?o.scrollLeft=e:o.scrollTop=e}function l(){return n?o.scrollLeft:o.scrollTop}var s=l(),u=(s-e)/2,f=0,h=d();window.requestAnimationFrame(c)})}function d(){return window.performance?window.performance.now():window.Date.now()}function f(e){return!!e.requestFullscreen||(!!e.webkitRequestFullscreen||(!!e.mozRequestFullScreen||!!e.msRequestFullscreen))}function h(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function g(){var e=document;e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.msExitFullscreen&&e.msExitFullscreen()}function w(e){var t=document.addEventListener;t("fullscreenchange",e),t("webkitfullscreenchange",e),t("mozfullscreenchange",e),t("MSFullscreenChange",e)}function v(e){var t=document.removeEventListener;t("fullscreenchange",e),t("webkitfullscreenchange",e),t("mozfullscreenchange",e),t("MSFullscreenChange",e)}function p(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}e="default"in e?e.default:e,e.tag2("icon-fullscreen-enter",'<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 385 385"> <path d="M385 12c0-6.7-5.3-12-12-12H264.7c-6.8 0-12 5.4-12 12.2 0 6.8 5.2 12 12 12h96v96.4c0 6.8 5 12 12 12 6.8 0 12-5.2 12-12l.2-108.4V12zM120.5 0h-108-.2C5.4 0 .2 5.3.2 12L0 120.4c0 6.8 5.4 12 12.2 12 6.8 0 12-5.2 12-12V24h96.3c6.8 0 12-5 12-12 0-6.8-5.2-12-12-12zM120 361H24v-96.3c0-7-5-12-12-12s-12 5-12 12V373c0 6.7 5.3 12 12 12h108c7 0 12-5.4 12-12.3 0-6.8-5-11.8-12-11.8zM372.7 253c-6.8 0-11.8 5-11.8 11.8v96h-96.3c-7 0-12 5.3-12 12s5 12.2 12 12.2H373c6.7 0 12-5.3 12-12V264.7c0-6.8-5.4-12-12.3-12z"></path> </svg>','icon-fullscreen-enter,[data-is="icon-fullscreen-enter"]{ display: inline-block; width: 32px; fill: currentColor; }',"",function(e){}),e.tag2("icon-fullscreen-exit",'<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 385 385"> <path d="M253 120.6c0 6.7 5.2 12 12 12h108c7 0 12-5.4 12-12.2 0-6.8-5-12-12-12h-96l.2-96.4c0-6.8-5.2-12-12-12-7 0-12 5.2-12 12l-.3 108.4v.2zM12 132.3h108.2c6.8 0 12-5.3 12-12l.3-108.4c0-7-5.4-12-12.2-12-6.8 0-11.8 5-11.8 12l-.2 96.3H12c-6.8 0-12 5.2-12 12s5.2 12 12 12zM12 276.7h96V373c0 6.8 5.2 12 12 12 7 0 12-5.2 12-12V264.7c0-6.8-5.3-12.2-12-12.2H12c-7 0-12 5.4-12 12.3 0 6.7 5 11.7 12 11.7zM265 385c6.7 0 11.7-5 11.7-12v-96H373c6.8 0 12-5.2 12-12 0-7-5.2-12-12-12H264.7c-6.8 0-12.2 5.2-12.2 12v108c0 7 5.4 12 12.3 12z"></path> </svg>','icon-fullscreen-exit,[data-is="icon-fullscreen-exit"]{ display: inline-block; width: 32px; fill: currentColor; }',"",function(e){}),e.tag2("icon-arrow-left",'<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 385 385"><path d="M55.3 185L183 57.7c4.7-5 4.7-12.2 0-17-5-5-12.3-5-17 0L18.3 188c-5 4.7-5 12.3 0 17l147 147.2c4.8 4.8 12.2 4.6 17-.3 5-5 4.8-12 0-17l-126-126H355c7 0 12-5 12-12 0-6.8-5-12-12-12h-300z"></path></svg>','icon-arrow-left,[data-is="icon-arrow-left"]{ display: inline-block; width: 32px; fill: currentColor; }',"",function(e){}),e.tag2("icon-arrow-right",'<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 385 385"> <path d="M326.7 207.7L199 335c-4.7 5-4.7 12.2 0 17 5 5 12.3 5 17 0L363.7 205c5-4.8 5-12.3 0-17l-147-147.2c-4.8-5-12.3-4.7-17 .2-5 4.8-5 12 0 16.8l126 126h-299c-6.7 0-12 5.3-12 12 0 7 5.3 12 12 12h300z"></path> </svg>','icon-arrow-right,[data-is="icon-arrow-right"]{ display: inline-block; width: 32px; fill: currentColor; }',"",function(e){});var m=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),b=new WeakMap,k=function(){function e(){t(this,e),b.set(this,{events:{}}),this.eventLength=0}return m(e,[{key:"on",value:function(e,t){if(void 0===t)throw new Error("You must provide a callback method.");if("function"!=typeof t)throw new TypeError("Listener must be a function");return this.events[e]=this.events[e]||[],this.events[e].push(t),this.eventLength++,this}},{key:"off",value:function(e,t){if(void 0===t)throw new Error("You must provide a callback method.");if("function"!=typeof t)throw new TypeError("Listener must be a function");if(void 0===this.events[e])throw new Error("Event not found - the event you provided is: "+e);var n=this.events[e];return n.forEach(function(e,o){e===t&&n.splice(o,1)}),0===n.length&&(delete this.events[e],this.eventLength--),this}},{key:"trigger",value:function(e){for(var t=this,n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];if(void 0===e)throw new Error("You must provide an event to trigger.");var r=this.events[e];return void 0!==r&&(r=r.slice(0),r.forEach(function(e){e.apply(t,o)})),this}},{key:"events",get:function(){return b.get(this).events}}]),e}(),y=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),x=[0,1,-1,-2,2,3,4,5,6,7],L={title:"",firstPageSpread:!1,rightToLeft:!0,defaultPageWidth:595,defaultPageHeight:842},S=function(e){function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=Array.isArray(e)?e:n(e);return Object.assign(i,L,s(o,L)),i.pages=r.map(function(e){return new F(e,{defaultPageWidth:i.defaultPageWidth,defaultPageHeight:i.defaultPageHeight})}),i.que=[],i.loadingPage=null,i}return l(t,e),y(t,[{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t-=0,this.que=x.map(function(e){return e+t}).filter(function(t){return t>=0&&t<e.pages.length}).map(function(t){return e.pages[t]}).filter(function(e){return!e.loaded&&!e.loading}),this.loadingPage||this.loadNextInQue()}},{key:"loadNextInQue",value:function(){var e=this;this.loadingPage=this.que.shift(),this.loadingPage&&(this.loadingPage.on("imageLoaded",function(t){e.trigger("pageLoaded",t),e.loadNextInQue()}),this.loadingPage.load())}}]),t}(k),F=function(e){function t(e,n){c(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.url=e,o.loading=!1,o.loaded=!1,o.width=n.defaultPageWidth,o.height=n.defaultPageHeight,o}return l(t,e),y(t,[{key:"load",value:function(){var e=this;this.loading=!0;var t=new window.Image;t.src=this.url,t.onload=function(){var n=t.width,o=t.height;e.width=n,e.height=o,e.loaded=!0,e.loading=!1,e.trigger("imageLoaded",e)}}}]),t}(k),P={};e.tag2("comic-viewer",'<div class="btn-go-forward" onclick="{goForward}"></div> <div class="btn-go-back" onclick="{goBack}"></div> <header if="{title && toolbarMode}">{title}</header> <div class="outer" riot-style="{outerStyle}"> <div ref="stage" class="inner" riot-style="{innerStyle}" onclick="{toggleMode}" ondblclick="{toggleFullScreen}"> <span each="{stack}" class="{dummy: dummy}" riot-style="width: {width * parent.pageScale}px; background-image: url({url});"></span> </div> </div> <footer if="{toolbarMode}"> <icon-arrow-left onclick="{goToLeft}"></icon-arrow-left> <icon-arrow-right onclick="{goToRight}"></icon-arrow-right> <icon-fullscreen-enter if="{!fullScreenMode}" onclick="{toggleFullScreen}"></icon-fullscreen-enter> <icon-fullscreen-exit if="{fullScreenMode}" onclick="{toggleFullScreen}"></icon-fullscreen-exit> </footer>','comic-viewer,[data-is="comic-viewer"]{ display: block; position: relative; background: white; overflow: hidden; } comic-viewer:focus,[data-is="comic-viewer"]:focus{ outline: none; } comic-viewer header,[data-is="comic-viewer"] header,comic-viewer footer,[data-is="comic-viewer"] footer,comic-viewer .btn-go-forward,[data-is="comic-viewer"] .btn-go-forward,comic-viewer .btn-go-back,[data-is="comic-viewer"] .btn-go-back{ position: absolute; } comic-viewer.fullscreen header,[data-is="comic-viewer"].fullscreen header,comic-viewer.fullscreen footer,[data-is="comic-viewer"].fullscreen footer,comic-viewer.fullscreen .btn-go-forward,[data-is="comic-viewer"].fullscreen .btn-go-forward,comic-viewer.fullscreen .btn-go-back,[data-is="comic-viewer"].fullscreen .btn-go-back{ position: fixed; } comic-viewer header,[data-is="comic-viewer"] header{ top: 0; left: 0; right: 0; height: 24px; padding: 0 1em; background: rgba(0,0,0,.8); color: rgba(255,255,255,.7); line-height: 24px; font-size: 80%; overflow: hidden; box-sizing: content-box; } comic-viewer footer,[data-is="comic-viewer"] footer{ bottom: 0; left: 0; right: 0; height: 32px; background: rgba(0,0,0,.8); color: rgba(255,255,255,.7); padding: 14px; box-sizing: content-box; } comic-viewer footer > icon-arrow-left,[data-is="comic-viewer"] footer > icon-arrow-left,comic-viewer footer > icon-arrow-right,[data-is="comic-viewer"] footer > icon-arrow-right{ margin-right: 5px; cursor: pointer; } comic-viewer footer > icon-fullscreen-enter,[data-is="comic-viewer"] footer > icon-fullscreen-enter,comic-viewer footer > icon-fullscreen-exit,[data-is="comic-viewer"] footer > icon-fullscreen-exit{ float: right; cursor: pointer; } comic-viewer .outer,[data-is="comic-viewer"] .outer{ overflow: hidden; box-sizing: content-box; } comic-viewer .inner,[data-is="comic-viewer"] .inner{ padding-bottom: 30px; display: block; overflow: hidden; white-space: nowrap; box-sizing: content-box; } comic-viewer .btn-go-forward,[data-is="comic-viewer"] .btn-go-forward,comic-viewer .btn-go-back,[data-is="comic-viewer"] .btn-go-back{ top: 0; bottom: 0; width: 25%; cursor: pointer; } comic-viewer .btn-go-forward,[data-is="comic-viewer"] .btn-go-forward,comic-viewer.rtol .btn-go-back,[data-is="comic-viewer"].rtol .btn-go-back{ right: 0; left: auto; } comic-viewer .btn-go-back,[data-is="comic-viewer"] .btn-go-back,comic-viewer.rtol .btn-go-forward,[data-is="comic-viewer"].rtol .btn-go-forward{ right: auto; left: 0; } comic-viewer .inner > span,[data-is="comic-viewer"] .inner > span{ height: 100%; display: inline-block; background-repeat: no-repeat; background-size: cover; } comic-viewer .inner > span.dummy,[data-is="comic-viewer"] .inner > span.dummy{ visibility: hidden; }','class="{fullscreen: fullScreenMode, rtol: rightToLeft}" tabindex="0" riot-style="{style}"',function(e){var t=this,n=void 0,o=0,i=0,r=!1,c=!1,a=!1;this.title="",this.firstPageSpread=!1,this.rightToLeft=!0,this.pageCount=0,this.currentIndex=0,this.pageScale=1,this.stack=[],this.style="",this.outerStyle="",this.innerStyle="",this.landscapeMode=!1,this.toolbarMode=!0,this.fullScreenMode=!1,this.on("mount",function(){r=f(t.root),n=new S(e.pages,{title:e.title,firstPageSpread:"yes"===e.firstPageSpread,rightToLeft:void 0===e.direction||"manga"===e.direction}),n.on("pageLoaded",function(e){a||t.stack.find(function(t){return t.url===e.url})&&t.update()});var o=n.title,i=n.firstPageSpread,c=n.rightToLeft,l=n.pages.length,s=e.pages,u=(window.localStorage.getItem(s)||0)-0,d=(e.width?"width:"+e.width+"px;":"")+(e.height?"height:"+e.height+"px;":"");n.load(u),t.root.setAttribute("style",d);var h={title:o,firstPageSpread:i,rightToLeft:c,pageCount:l,currentIndex:u,style:d};t.update(h),w(t.update),window.addEventListener("optimizedResize",t.update),t.root.addEventListener("keydown",t.keydown),t.root.addEventListener("touchstart",t.touchstart),t.root.addEventListener("touchmove",t.touchmove),t.root.addEventListener("touchend",t.touchend)}),this.on("update",function(){var o=t.currentIndex,i=n.pages.length,a=n.rightToLeft,l=t.firstPageSpread,s=p()||c,u=s?window.innerWidth:t.root.offsetWidth,d=s?window.innerHeight:t.root.offsetHeight,f=d<u,h=o-(f?2:1),g=h>=0?h:0,w=f&&!l&&0===g,v=h+(f?6:3)-(w&&0===o),m=v<i?v:i,b=f&&!!(i%2-!l)&&!(m!==i),k=n.pages.slice(g,m),y=w?Object.assign({dummy:!0},k[0]):[],x=b?Object.assign({dummy:!0},k[k.length-1]):[],L=[].concat(y,k,x),S=a?[].concat(L).reverse():[].concat(L),F=S.length?S[0].width:n.defaultPageWidth,P=S.length?S[0].height:n.defaultPageHeight,M=u/d,E=F*(f?2:1)/P,z=M>E?d*E:u,T=M>E?d:u/E,I=M>E?T/P:z/(f?2:1)/F,j=M>E?0:(d-T)/2,q=M>E?(u-z)/2:0,O=r||!s?"":"\n        position: fixed;\n        top: 0; right: 0; bottom: 0; left: 0;\n        width: "+window.innerWidth+"px;\n        height: "+window.innerHeight+"px;\n        z-index: 2147483647;\n      ",C=O+(s?";":(e.width?"width:"+e.width+"px;":"")+(e.height?"height:"+e.height+"px;":"")),H="\n        width: "+z+"px;\n        height: "+T+"px;\n        margin: "+j+"px "+q+"px;\n      ",R="\n        width: "+z+"px;\n        height: "+T+"px;\n      ",_=o-g+(w&&o>0?1:0),W=a?L.slice(_+(f?2:1),L.length):L.slice(0,_),B=I*W.reduce(function(e,t){return e+t.width},0);Object.assign(t,{fullScreenMode:s,landscapeMode:f,style:C,pageScale:I,stageWidth:z,outerStyle:H,scrollLeft:B,innerStyle:R,stack:S})}),this.on("updated",function(){t.refs.stage.scrollLeft=t.scrollLeft}),this.on("unmount",function(){v(t.update),window.removeEventListener("optimizedResize",t.update),t.root.removeEventListener("keydown",t.keydown)}),this.toggleMode=function(e){t.toolbarMode=!t.toolbarMode},this.toggleFullScreen=function(e){r?t.fullScreenMode?g():h(t.root):c=!t.fullScreenMode},this.adjustScrollPosition=function(e){var n=t.refs.stage,o=t.stageWidth,i=n.scrollLeft-t.scrollLeft;return Math.abs(i)<1?Promise.resolve():i<-1*o*.33?u(0,500,!0,n).then(t.goForward):i>.33*o?u(2*o,500,!0,n).then(t.goBack):u(t.scrollLeft,500,!0,n).then(t.update)},this.touchstart=function(e){1==e.touches.length&&(o=t.refs.stage.scrollLeft,i=e.touches[0].clientX,a=!0)},this.touchmove=function(e){if(1==e.touches.length){var n=o-(e.touches[0].clientX-i);t.refs.stage.scrollLeft=n}},this.touchend=function(e){if(1==e.changedTouches.length){var n=o-(e.changedTouches[0].clientX-i);t.refs.stage.scrollLeft=n,t.adjustScrollPosition().then(function(){a=!1})}},this.keydown=function(e){switch(e.keyCode){case 37:return t.rightToLeft?t.goForward():t.goBack(),void e.preventDefault();case 39:t.rightToLeft?t.goBack():t.goForward(),e.preventDefault()}},this.goToLeft=function(){t.rightToLeft?t.goForward():t.goBack()},this.goToRight=function(){t.rightToLeft?t.goBack():t.goForward()},this.goForward=function(){var e=t.currentIndex,o=n.pages.length,i=t.landscapeMode,r=t.firstPageSpread,c=o-1-(i&&!(o%2-!r));e>=c?t.currentIndex=c:t.currentIndex+=i&&(r||0!==e)?2:1,n.load(t.currentIndex),t.update(),t.saveBookmark()},this.goBack=function(){t.currentIndex-=t.landscapeMode?2:1,t.currentIndex<0&&(t.currentIndex=0),n.load(t.currentIndex),t.update(),t.saveBookmark()},this.saveBookmark=function(){var n=e.pages;window.localStorage.setItem(n,t.currentIndex)}}),function(e,t,n){n=n||window;var o=!1;n.addEventListener(e,function(){o||(o=!0,window.requestAnimationFrame(function(){n.dispatchEvent(new window.CustomEvent(t)),o=!1}))})}("resize","optimizedResize")}(riot);