!function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){var t=/^(.*)\[(\d+)-(\d+)\](.*)$/;if(!t.test(e))return[e];var n=e.match(t),r=n[2]-0,c=n[3]-0,a=n[1],l=n[4],s=r<c?r:c,u=r<c?c:r,d=n[2].length;if(Number.isNaN(s)||Number.isNaN(u))throw new Error("Check your url. The pattern should be like this: /images/[001-032].jpg");return o(s,u).map(function(e){return a+i(e,d)+l})}function o(e,t){return Array.from({length:t-e+1},function(t,n){return(t||e)+n})}function i(e,t){var n=e+"",o=t-n.length;return(o>0?"0".repeat(o):"")+n}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){return Object.keys(e).filter(function(e){return void 0!==t[e]}).reduce(function(t,n){return Object.assign(t,r({},n,e[n]))},{})}function u(e,t,n,o){return t=t||1e3,n=n||!1,o=o||window,P[o]=e,new Promise(function(i,r){function c(n){if(e!==P[o])return r(new Error("Another scroll detected"));if((f+=Math.PI/(t/(n-h)))>=Math.PI)return a(e),i();if(l()===e)return i();var s=e+Math.round(u+u*Math.cos(f));if(a(s),s===e)return i();h=n,window.requestAnimationFrame(c)}function a(e){n?o.scrollLeft=e:o.scrollTop=e}function l(){return n?o.scrollLeft:o.scrollTop}var s=l(),u=(s-e)/2,f=0,h=d();window.requestAnimationFrame(c)})}function d(){return window.performance?window.performance.now():window.Date.now()}function f(e){return new Promise(function(t,n){window.setTimeout(t,e)})}function h(e){return!!e.requestFullscreen||(!!e.webkitRequestFullscreen||(!!e.mozRequestFullScreen||!!e.msRequestFullscreen))}function g(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function w(){var e=document;e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.msExitFullscreen&&e.msExitFullscreen()}function v(e){var t=document.addEventListener;t("fullscreenchange",e),t("webkitfullscreenchange",e),t("mozfullscreenchange",e),t("MSFullscreenChange",e)}function p(e){var t=document.removeEventListener;t("fullscreenchange",e),t("webkitfullscreenchange",e),t("mozfullscreenchange",e),t("MSFullscreenChange",e)}function m(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}e="default"in e?e.default:e,e.tag2("icon-fullscreen-enter",'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewbox="0 0 384.97 384.97"> <path d="M384.97,12.03c0-6.713-5.317-12.03-12.03-12.03H264.847c-6.833,0-11.922,5.39-11.934,12.223 c0,6.821,5.101,11.838,11.934,11.838h96.062l-0.193,96.519c0,6.833,5.197,12.03,12.03,12.03c6.833-0.012,12.03-5.197,12.03-12.03 l0.193-108.369c0-0.036-0.012-0.06-0.012-0.084C384.958,12.09,384.97,12.066,384.97,12.03z"></path> <path d="M120.496,0H12.403c-0.036,0-0.06,0.012-0.096,0.012C12.283,0.012,12.247,0,12.223,0C5.51,0,0.192,5.317,0.192,12.03 L0,120.399c0,6.833,5.39,11.934,12.223,11.934c6.821,0,11.838-5.101,11.838-11.934l0.192-96.339h96.242 c6.833,0,12.03-5.197,12.03-12.03C132.514,5.197,127.317,0,120.496,0z"></path> <path d="M120.123,360.909H24.061v-96.242c0-6.833-5.197-12.03-12.03-12.03S0,257.833,0,264.667v108.092 c0,0.036,0.012,0.06,0.012,0.084c0,0.036-0.012,0.06-0.012,0.096c0,6.713,5.317,12.03,12.03,12.03h108.092 c6.833,0,11.922-5.39,11.934-12.223C132.057,365.926,126.956,360.909,120.123,360.909z"></path> <path d="M372.747,252.913c-6.833,0-11.85,5.101-11.838,11.934v96.062h-96.242c-6.833,0-12.03,5.197-12.03,12.03 s5.197,12.03,12.03,12.03h108.092c0.036,0,0.06-0.012,0.084-0.012c0.036-0.012,0.06,0.012,0.096,0.012 c6.713,0,12.03-5.317,12.03-12.03V264.847C384.97,258.014,379.58,252.913,372.747,252.913z"></path> </svg>','icon-fullscreen-enter,[data-is="icon-fullscreen-enter"]{ display: inline-block; width: 32px; fill: currentColor; }',"",function(e){}),e.tag2("icon-fullscreen-exit",'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewbox="0 0 384.97 384.97"> <path d="M252.913,120.58 C252.913,127.293 258.23,132.61 264.943,132.61 L373.036,132.61 C379.869,132.61 384.958,127.22 384.97,120.387 C384.97,113.566 379.869,108.549 373.036,108.549 L276.974,108.549 L277.167,12.03 C277.167,5.197 271.97,2.84217094e-14 265.137,0 C258.304,0.012 253.107,5.197 253.107,12.03 L252.914,120.399 C252.914,120.435 252.926,120.459 252.926,120.483 C252.925,120.52 252.913,120.544 252.913,120.58 Z"></path> <path d="M12.029,132.333 L120.122,132.333 C120.158,132.333 120.182,132.321 120.218,132.321 C120.242,132.321 120.278,132.333 120.302,132.333 C127.015,132.333 132.333,127.016 132.333,120.303 L132.525,11.934 C132.525,5.101 127.135,0 120.302,0 C113.481,0 108.464,5.101 108.464,11.934 L108.272,108.273 L12.03,108.273 C5.197,108.273 0,113.47 0,120.303 C0.011,127.136 5.208,132.333 12.029,132.333 Z"></path> <path d="M11.933,276.697 L107.995,276.697 L107.995,372.939 C107.995,379.772 113.192,384.969 120.025,384.969 C126.858,384.969 132.056,379.773 132.056,372.939 L132.056,264.847 C132.056,264.811 132.044,264.787 132.044,264.763 C132.044,264.727 132.056,264.703 132.056,264.667 C132.056,257.954 126.739,252.637 120.026,252.637 L11.934,252.637 C5.101,252.637 0.012,258.027 0,264.86 C-0.001,271.68 5.1,276.697 11.933,276.697 Z"></path> <path d="M264.859,384.969 C271.692,384.969 276.709,379.868 276.697,373.035 L276.697,276.973 L372.939,276.973 C379.772,276.973 384.969,271.776 384.969,264.943 C384.969,258.11 379.772,252.913 372.939,252.913 L264.847,252.913 C264.811,252.913 264.787,252.925 264.763,252.925 C264.727,252.937 264.703,252.913 264.667,252.913 C257.954,252.913 252.637,258.23 252.637,264.943 L252.637,373.035 C252.636,379.868 258.026,384.969 264.859,384.969 Z"></path> </svg>','icon-fullscreen-exit,[data-is="icon-fullscreen-exit"]{ display: inline-block; width: 32px; fill: currentColor; }',"",function(e){}),e.tag2("icon-arrow-left",'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewbox="0 0 384.97 384.97"> <path d="M55.2944256,185 L182.867688,57.6770691 C187.699349,52.8454085 187.699349,45.4957406 182.867688,40.6640799 C178.027542,35.8409046 170.68636,35.8324193 165.854699,40.6640799 L18.3790947,187.866741 C13.5035934,192.740828 13.5035934,200.260202 18.2504012,205.00701 L165.394373,352.150981 C170.226033,356.982642 177.635805,356.769803 182.475951,351.946627 C187.299127,347.123452 187.23973,339.968945 182.408069,335.137285 L56.3307842,209.06 L355.242,209.06 C362.075,209.06 367.272,203.863 367.272,197.03 C367.272,190.197 362.075,185 355.242,185 L55.2944256,185 L55.2944256,185 Z"></path> </svg>','icon-arrow-left,[data-is="icon-arrow-left"]{ display: inline-block; width: 32px; fill: currentColor; }',"",function(e){}),e.tag2("icon-arrow-right",'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewbox="0 0 384.97 384.97"> <path d="M326.683795,207.714573 L199.110532,335.037504 C194.278872,339.869164 194.278872,347.218832 199.110532,352.050493 C203.950678,356.873668 211.291861,356.882154 216.123522,352.050493 L363.599126,204.847832 C368.474627,199.973745 368.474627,192.454371 363.727819,187.707563 L216.583848,40.5635918 C211.752187,35.7319312 204.342415,35.9447703 199.50227,40.7679457 C194.679094,45.591121 194.738491,52.7456275 199.570152,57.5772881 L325.647437,183.654573 L26.7362207,183.654573 C19.9032207,183.654573 14.7062207,188.851573 14.7062207,195.684573 C14.7062207,202.517573 19.9032207,207.714573 26.7362207,207.714573 L326.683795,207.714573 L326.683795,207.714573 Z"></path> </svg>','icon-arrow-right,[data-is="icon-arrow-right"]{ display: inline-block; width: 32px; fill: currentColor; }',"",function(e){});var b=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),y=new WeakMap,k=function(){function e(){t(this,e),y.set(this,{events:{}}),this.eventLength=0}return b(e,[{key:"on",value:function(e,t){if(void 0===t)throw new Error("You must provide a callback method.");if("function"!=typeof t)throw new TypeError("Listener must be a function");return this.events[e]=this.events[e]||[],this.events[e].push(t),this.eventLength++,this}},{key:"off",value:function(e,t){if(void 0===t)throw new Error("You must provide a callback method.");if("function"!=typeof t)throw new TypeError("Listener must be a function");if(void 0===this.events[e])throw new Error("Event not found - the event you provided is: "+e);var n=this.events[e];return n.forEach(function(e,o){e===t&&n.splice(o,1)}),0===n.length&&(delete this.events[e],this.eventLength--),this}},{key:"trigger",value:function(e){for(var t=this,n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];if(void 0===e)throw new Error("You must provide an event to trigger.");var r=this.events[e];return void 0!==r&&(r=r.slice(0),r.forEach(function(e){e.apply(t,o)})),this}},{key:"events",get:function(){return y.get(this).events}}]),e}(),x=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),L=[0,1,-1,-2,2,3,4,5,6,7],C={title:"",firstPageSpread:!1,rightToLeft:!0,defaultPageWidth:595,defaultPageHeight:842},S=function(e){function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=Array.isArray(e)?e:n(e);return Object.assign(i,C,s(o,C)),i.pages=r.map(function(e){return new F(e,{defaultPageWidth:i.defaultPageWidth,defaultPageHeight:i.defaultPageHeight})}),i.que=[],i.loadingPage=null,i}return l(t,e),x(t,[{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t-=0,this.que=L.map(function(e){return e+t}).filter(function(t){return t>=0&&t<e.pages.length}).map(function(t){return e.pages[t]}).filter(function(e){return!e.loaded&&!e.loading}),this.loadingPage||this.loadNextInQue()}},{key:"loadNextInQue",value:function(){var e=this;this.loadingPage=this.que.shift(),this.loadingPage&&(this.loadingPage.on("imageLoaded",function(t){e.trigger("pageLoaded",t),e.loadNextInQue()}),this.loadingPage.load())}}]),t}(k),F=function(e){function t(e,n){c(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.url=e,o.loading=!1,o.loaded=!1,o.width=n.defaultPageWidth,o.height=n.defaultPageHeight,o}return l(t,e),x(t,[{key:"load",value:function(){var e=this;this.loading=!0;var t=new window.Image;t.src=this.url,t.onload=function(){var n=t.width,o=t.height;e.width=n,e.height=o,e.loaded=!0,e.loading=!1,e.trigger("imageLoaded",e)}}}]),t}(k),P={};e.tag2("comic-viewer",'<div class="btn-go-forward" onclick="{goForward}"></div> <div class="btn-go-back" onclick="{goBack}"></div> <header if="{title && toolbarMode}">{title}</header> <div class="outer" riot-style="{outerStyle}"> <div ref="stage" class="inner" riot-style="{innerStyle}" onclick="{toggleMode}" ondblclick="{toggleFullScreen}"> <span each="{stack}" class="{dummy: dummy}" riot-style="width: {width * parent.pageScale}px; background-image: url({url});"></span> </div> </div> <footer if="{toolbarMode}"> <icon-arrow-left onclick="{goToLeft}"></icon-arrow-left> <icon-arrow-right onclick="{goToRight}"></icon-arrow-right> <icon-fullscreen-enter if="{!fullScreenMode}" onclick="{toggleFullScreen}"></icon-fullscreen-enter> <icon-fullscreen-exit if="{fullScreenMode}" onclick="{toggleFullScreen}"></icon-fullscreen-exit> </footer>','comic-viewer,[data-is="comic-viewer"]{ display: block; position: relative; background: white; overflow: hidden; } comic-viewer:focus,[data-is="comic-viewer"]:focus{ outline: none; } comic-viewer header,[data-is="comic-viewer"] header,comic-viewer footer,[data-is="comic-viewer"] footer,comic-viewer .btn-go-forward,[data-is="comic-viewer"] .btn-go-forward,comic-viewer .btn-go-back,[data-is="comic-viewer"] .btn-go-back{ position: absolute; z-index: 100; } comic-viewer.fullscreen header,[data-is="comic-viewer"].fullscreen header,comic-viewer.fullscreen footer,[data-is="comic-viewer"].fullscreen footer,comic-viewer.fullscreen .btn-go-forward,[data-is="comic-viewer"].fullscreen .btn-go-forward,comic-viewer.fullscreen .btn-go-back,[data-is="comic-viewer"].fullscreen .btn-go-back{ position: fixed; } comic-viewer header,[data-is="comic-viewer"] header{ top: 0; left: 0; right: 0; height: 24px; padding: 0 1em; background: rgba(0,0,0,.8); color: rgba(255,255,255,.7); line-height: 24px; font-size: 80%; overflow: hidden; } comic-viewer footer,[data-is="comic-viewer"] footer{ bottom: 0; left: 0; right: 0; height: 32px; background: rgba(0,0,0,.8); color: rgba(255,255,255,.7); padding: 14px; } comic-viewer footer > icon-arrow-left,[data-is="comic-viewer"] footer > icon-arrow-left,comic-viewer footer > icon-arrow-right,[data-is="comic-viewer"] footer > icon-arrow-right{ margin-right: 5px; cursor: pointer; } comic-viewer footer > icon-fullscreen-enter,[data-is="comic-viewer"] footer > icon-fullscreen-enter,comic-viewer footer > icon-fullscreen-exit,[data-is="comic-viewer"] footer > icon-fullscreen-exit{ float: right; cursor: pointer; } comic-viewer .outer,[data-is="comic-viewer"] .outer{ overflow: hidden; } comic-viewer .inner,[data-is="comic-viewer"] .inner{ padding-bottom: 30px; display: block; overflow: hidden; white-space: nowrap; } comic-viewer .btn-go-forward,[data-is="comic-viewer"] .btn-go-forward,comic-viewer .btn-go-back,[data-is="comic-viewer"] .btn-go-back{ top: 0; bottom: 0; width: 25%; cursor: pointer; } comic-viewer .btn-go-forward,[data-is="comic-viewer"] .btn-go-forward,comic-viewer.rtol .btn-go-back,[data-is="comic-viewer"].rtol .btn-go-back{ right: 0; left: auto; } comic-viewer .btn-go-back,[data-is="comic-viewer"] .btn-go-back,comic-viewer.rtol .btn-go-forward,[data-is="comic-viewer"].rtol .btn-go-forward{ right: auto; left: 0; } comic-viewer .inner > span,[data-is="comic-viewer"] .inner > span{ height: 100%; display: inline-block; background-repeat: no-repeat; background-size: cover; } comic-viewer .inner > span.dummy,[data-is="comic-viewer"] .inner > span.dummy{ visibility: hidden; }','class="{fullscreen: fullScreenMode, rtol: rightToLeft}" tabindex="0" riot-style="{style}"',function(e){var t=this,n=void 0,o=0,i=0,r=!1,c=!1,a=!1;this.title="",this.firstPageSpread=!1,this.rightToLeft=!0,this.pageCount=0,this.currentIndex=0,this.pageScale=1,this.stack=[],this.style="",this.outerStyle="",this.innerStyle="",this.landscapeMode=!1,this.toolbarMode=!1,this.fullScreenMode=!1,this.on("mount",function(){r=h(t.root),n=new S(e.pages,{title:e.title,firstPageSpread:"yes"===e.firstPageSpread,rightToLeft:void 0===e.direction||"manga"===e.direction}),n.on("pageLoaded",function(e){a||t.stack.find(function(t){return t.url===e.url})&&t.update()});var o=n.title,i=n.firstPageSpread,c=n.rightToLeft,l=n.pages.length,s=e.pages,u=(window.localStorage.getItem(s)||0)-0,d=(e.width?"width:"+e.width+"px;":"")+(e.height?"height:"+e.height+"px;":"");n.load(u),t.root.setAttribute("style",d);var f={title:o,firstPageSpread:i,rightToLeft:c,pageCount:l,currentIndex:u,style:d};t.update(f),v(t.update),window.addEventListener("optimizedResize",t.update),t.root.addEventListener("keydown",t.keydown),t.root.addEventListener("touchstart",t.touchstart),t.root.addEventListener("touchmove",t.touchmove),t.root.addEventListener("touchend",t.touchend)}),this.on("update",function(){var o=t.currentIndex,i=n.pages.length,a=n.rightToLeft,l=t.firstPageSpread,s=m()||c,u=s?window.innerWidth:t.root.offsetWidth,d=s?window.innerHeight:t.root.offsetHeight,f=d<u,h=o-(f?2:1),g=h>=0?h:0,w=f&&!l&&0===g,v=h+(f?6:3)-(w&&0===o),p=v<i?v:i,b=f&&!!(i%2-!l)&&!(p!==i),y=n.pages.slice(g,p),k=w?Object.assign({dummy:!0},y[0]):[],x=b?Object.assign({dummy:!0},y[y.length-1]):[],L=[].concat(k,y,x),C=a?[].concat(L).reverse():[].concat(L),S=s?window.innerWidth:e.width?"width:"+e.width+"px;":"",F=s?window.innerHeight:e.height?"height:"+e.height+"px;":"",P=S+F,E=C.length?C[0].width:n.defaultPageWidth,M=C.length?C[0].height:n.defaultPageHeight,T=u/d,z=E*(f?2:1)/M,I=T>z?d*z:u,j=T>z?d:u/z,q=T>z?j/M:I/(f?2:1)/E,O=T>z?0:(d-j)/2,R=T>z?(u-I)/2:0,_=r||!s?"":"\n        position: fixed;\n        top: 0; right: 0; bottom: 0; left: 0;\n      ",H=_+"\n        width: "+I+"px;\n        height: "+j+"px;\n        margin: "+O+"px "+R+"px;\n      ",W="\n        width: "+I+"px;\n        height: "+j+"px;\n      ",B=o-g+(w&&o>0?1:0),A=a?L.slice(B+(f?2:1),L.length):L.slice(0,B),N=q*A.reduce(function(e,t){return e+t.width},0);Object.assign(t,{fullScreenMode:s,landscapeMode:f,style:P,pageScale:q,stageWidth:I,outerStyle:H,scrollLeft:N,innerStyle:W,stack:C})}),this.on("updated",function(){f(50).then(function(){t.refs.stage.scrollLeft=t.scrollLeft})}),this.on("unmount",function(){p(t.update),window.removeEventListener("optimizedResize",t.update),t.root.removeEventListener("keydown",t.keydown)}),this.toggleMode=function(e){t.toolbarMode=!t.toolbarMode},this.toggleFullScreen=function(e){r?t.fullScreenMode?w():g(t.root):c=!t.fullScreenMode},this.adjustScrollPosition=function(e){var n=t.refs.stage,o=t.stageWidth,i=n.scrollLeft-t.scrollLeft;return i<-1*o*.33?u(0,500,!0,n).then(t.goForward):i>.33*o?u(2*o,500,!0,n).then(t.goBack):u(t.scrollLeft,500,!0,n).then(t.update)},this.touchstart=function(e){1==e.touches.length&&(o=t.refs.stage.scrollLeft,i=e.touches[0].clientX,a=!0)},this.touchmove=function(e){if(1==e.touches.length){var n=o-(e.touches[0].clientX-i);t.refs.stage.scrollLeft=n}},this.touchend=function(e){if(1==e.changedTouches.length){var n=o-(e.changedTouches[0].clientX-i);t.refs.stage.scrollLeft=n,t.adjustScrollPosition().then(function(){a=!1})}},this.keydown=function(e){switch(e.keyCode){case 37:return t.rightToLeft?t.goForward():t.goBack(),void e.preventDefault();case 39:t.rightToLeft?t.goBack():t.goForward(),e.preventDefault()}},this.goToLeft=function(){t.rightToLeft?t.goForward():t.goBack()},this.goToRight=function(){t.rightToLeft?t.goBack():t.goForward()},this.goForward=function(){var e=t.currentIndex,o=n.pages.length,i=t.landscapeMode,r=t.firstPageSpread,c=o-1-(i&&!(o%2-!r));e>=c?t.currentIndex=c:t.currentIndex+=i&&(r||0!==e)?2:1,n.load(t.currentIndex),t.update(),t.saveBookmark()},this.goBack=function(){t.currentIndex-=t.landscapeMode?2:1,t.currentIndex<0&&(t.currentIndex=0),n.load(t.currentIndex),t.update(),t.saveBookmark()},this.saveBookmark=function(){var n=e.pages;window.localStorage.setItem(n,t.currentIndex)}}),function(e,t,n){n=n||window;var o=!1;n.addEventListener(e,function(){o||(o=!0,window.requestAnimationFrame(function(){n.dispatchEvent(new window.CustomEvent(t)),o=!1}))})}("resize","optimizedResize")}(riot);